{% extends "pages/admin/base.html" %}

{% block title %}Detalle de Orden{% endblock title %}


{% block navbar %}
   {% include "components/admin/navbar.html" %}
{% endblock navbar %}

{% block content %}
<div class="container my-5">
    <div class="card shadow-lg">
        <div class="card-header bg-info text-white">
            <h1 class="text-center mb-0">Detalle de Orden</h1>
        </div>
        <div class="card-body">
            <h5><strong>Cliente:</strong> {{ orden.user.username }}</h5>
            <h5><strong>Número de Orden:</strong> {{ orden.numero_orden }}</h5>
            <h5><strong>Monto Total:</strong> ${{ orden.monto_total }}</h5>
            <h5><strong>Estado:</strong> 
                <span class="badge {% if orden.status == 'completed' %}bg-success{% elif orden.status == 'pending' %}bg-warning text-dark{% else %}bg-danger{% endif %}">
                    {{ orden.get_status_display }}
                </span>
            </h5>
            <h5><strong>Fecha:</strong> {{ orden.created_at|date:"d/m/Y H:i" }}</h5>
        </div>

        <!-- Dirección -->
        <div class="card-body">
            <h5><strong>Dirección de Entrega:</strong></h5>
            {% if direccion %}
                <p>{{ direccion.localidad }}, {{ direccion.main_street }}, {{ direccion.house_number }}</p>
                <p><strong>Barrio:</strong> {{ direccion.barrio }}</p>
                <p><strong>Código Postal:</strong> {{ direccion.postal_code }}</p>
                <p><strong>Contacto:</strong> {{ direccion.whatsapp_number }}</p>
                <p><strong>Email:</strong> {{ direccion.email }}</p>
            {% else %}
                <p class="text-muted">No se especificó una dirección de entrega.</p>
            {% endif %}
        </div>

        <!-- Cupón -->
        <!-- Cupón -->
        <div class="card-body">
            <h5><strong>Cupón:</strong></h5>
            {% if cupon %}
                <p><strong>Código:</strong> {{ cupon.code }}</p>
                <p><strong>Tipo de Descuento:</strong> {{ cupon.get_discount_type_display }}</p>
                <p><strong>Valor del Descuento:</strong> 
                    {% if cupon.discount_type == 'percent' %}
                        {{ cupon.discount_value }}%
                    {% else %}
                        ${{ cupon.discount_value }}
                    {% endif %}
                </p>
            {% else %}
                <p class="text-muted">No se usó ningún cupón para esta orden.</p>
            {% endif %}
        </div>


        <!-- Productos en la Orden -->
        <div class="card-body">
            <h5 class="text-center">Productos en la Orden</h5>
            <div class="table-responsive">
                <table class="table table-striped table-hover">
                    <thead class="table-dark">
                        <tr>
                            <th>#</th>
                            <th>Producto</th>
                            <th>Cantidad</th>
                            <th>Precio Unitario</th>
                            <th>Total</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for item in items %}
                        <tr>
                            <td>{{ forloop.counter }}</td>
                            <td>{{ item.product.title }}</td>
                            <td>{{ item.quantity }}</td>
                            <td>${{ item.price }}</td>
                            <td>${{ item.total_price }}</td>
                        </tr>
                        {% empty %}
                        <tr>
                            <td colspan="5" class="text-center text-muted">No hay productos en esta orden.</td>
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>
            </div>
        </div>

        <!-- Métodos de Pago y Envío -->
        <div class="card-body">
            <h5><strong>Método de Pago:</strong> {{ orden.get_payment_method_display }}</h5>
            <h5><strong>Método de Envío:</strong> {{ orden.get_metodo_envio_display }}</h5>
            <h5><strong>Estado de Pago:</strong> 
                <span class="badge {% if orden.estado_pago == 'confirmed' %}bg-success{% elif orden.estado_pago == 'pending' %}bg-warning text-dark{% else %}bg-danger{% endif %}">
                    {{ orden.get_estado_pago_display }}
                </span>
            </h5>
            {% if orden.fecha_entrega_estimada %}
            <h5><strong>Fecha de Entrega Estimada:</strong> {{ orden.fecha_entrega_estimada|date:"d/m/Y H:i" }}</h5>
            {% endif %}
        </div>

        <div class="card-footer text-muted text-center">
            Última actualización: {{ orden.updated_at|date:"d/m/Y H:i" }}
        </div>
    </div>
</div>
{% endblock content %}
