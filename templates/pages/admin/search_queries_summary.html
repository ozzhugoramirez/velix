{% extends "pages/admin/base.html" %}

{% block title %}Resumen de Términos de Búsqueda{% endblock title %}


{% block navbar %}
   {% include "components/admin/navbar.html" %}
{% endblock navbar %}

{% block content %}
<div class="container my-5">
    <h1 class="text-center mb-4">Resumen de Términos de Búsqueda</h1>

    <!-- Filtro por rango -->
    <form method="get" class="mb-4">
        <div class="row g-3 align-items-end">
            <div class="col-md-6">
                <label for="rango" class="form-label">Filtrar por rango</label>
                <select id="rango" name="rango" class="form-select">
                    <option value="all" {% if rango == "all" %}selected{% endif %}>Todos los datos</option>
                    <option value="last_week" {% if rango == "last_week" %}selected{% endif %}>Última semana</option>
                    <option value="last_month" {% if rango == "last_month" %}selected{% endif %}>Último mes</option>
                    <option value="last_year" {% if rango == "last_year" %}selected{% endif %}>Último año</option>
                </select>
            </div>
            <div class="col-md-2">
                <button type="submit" class="btn btn-primary w-100">Filtrar</button>
            </div>
        </div>
    </form>

    <!-- Botón de eliminar -->
    <form method="post" action="{% url 'confirm_delete_search_queries' %}">
        {% csrf_token %}
        <div class="row mb-3">
            <div class="col-12">
                <button type="submit" class="btn btn-danger">Borrar Seleccionados</button>
            </div>
        </div>

        <!-- Recuadros de términos de búsqueda -->
        <div class="row">
            <!-- Checkbox para seleccionar todos -->
            <div class="col-12 mb-3">
                <input type="checkbox" id="select-all" class="form-check-input">
                <label for="select-all" class="form-check-label">Seleccionar Todos</label>
            </div>

            {% for query in search_queries %}
            <div class="col-md-4 mb-3">
                <div class="card shadow-sm position-relative">
                    <div class="card-body text-center">
                        <h5 class="card-title">{{ query.term }}</h5>
                        <p class="display-6 text-primary">{{ query.total_count }}</p>
                        <!-- Checkbox para cada término -->
                        <input type="checkbox" name="queries" value="{{ query.id }}" class="form-check-input position-absolute top-0 start-0 m-2">
                    </div>
                </div>
            </div>
            {% empty %}
            <div class="col-12 text-center">
                <p class="text-muted">No se encontraron búsquedas para el rango seleccionado.</p>
            </div>
            {% endfor %}
        </div>
    </form>
</div>

<!-- Script para seleccionar/deseleccionar todos -->
<script>
    document.addEventListener('DOMContentLoaded', function() {
        const selectAll = document.getElementById('select-all');
        const checkboxes = document.querySelectorAll('input[name="queries"]');

        selectAll.addEventListener('change', function() {
            checkboxes.forEach(checkbox => {
                checkbox.checked = selectAll.checked;
            });
        });
    });
</script>
{% endblock content %}
