{% extends "pages/web/base.html" %}

{% block content %}
<div class="container mt-5">
    <div class="row justify-content-center">
        <div class="col-lg-6 col-md-8">
            <h2 class="text-center mb-4 fw-bold"><i class="bi bi-credit-card-fill"></i> Pago con Tarjeta</h2>
            <div class="card shadow-lg border-0">
                <div class="card-body p-4">
                    <form method="post" action="{% url 'payment_card' %}" id="paymentForm">
                        {% csrf_token %}

                        <!-- Nombre del titular -->
                        <div class="mb-3">
                            <label for="cardholder_name" class="form-label fw-bold"><i class="bi bi-person-fill"></i> Nombre del Titular</label>
                            <input type="text" id="cardholder_name" name="cardholder_name" class="form-control" placeholder="Ej: Juan Pérez" required>
                            <div class="invalid-feedback">Ingrese un nombre válido (solo letras).</div>
                        </div>

                        <!-- Número de tarjeta -->
                        <div class="mb-3">
                            <label for="card_number" class="form-label fw-bold"><i class="bi bi-credit-card"></i> Número de Tarjeta</label>
                            <input type="text" id="card_number" name="card_number" class="form-control" placeholder="#### #### #### ####" maxlength="19" required>
                            <div class="invalid-feedback">Ingrese un número de tarjeta válido.</div>
                        </div>

                        <!-- Fecha de Expiración y CVV -->
                        <div class="row">
                            <div class="col-md-6 mb-3">
                                <label for="expiration_date" class="form-label fw-bold"><i class="bi bi-calendar-event"></i> Fecha de Expiración</label>
                                <input type="text" id="expiration_date" name="expiration_date" class="form-control" placeholder="MM/AA" maxlength="5" required>
                                <div class="invalid-feedback">Formato inválido (MM/AA).</div>
                            </div>
                            <div class="col-md-6 mb-3">
                                <label for="cvv" class="form-label fw-bold"><i class="bi bi-lock-fill"></i> CVV</label>
                                <input type="text" id="cvv" name="cvv" class="form-control" placeholder="###" maxlength="4" required>
                                <div class="invalid-feedback">Ingrese un CVV válido (3-4 dígitos).</div>
                            </div>
                        </div>

                        <!-- Botón de confirmación con animación -->
                        <button type="submit" class="btn btn-primary w-100 btn-lg mt-3 shadow" id="payButton">
                            <i class="bi bi-check-circle-fill"></i> Confirmar Pago
                        </button>
                    </form>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Estilos y animaciones adicionales -->
<style>
    /* Estilo del botón */
    #payButton {
        transition: all 0.3s ease-in-out;
        font-size: 1.1rem;
    }
    #payButton:hover {
        transform: scale(1.05);
        background-color: #0056b3;
    }

    /* Sombras en la tarjeta */
    .card {
        transition: box-shadow 0.3s ease-in-out;
    }
    .card:hover {
        box-shadow: 0 8px 20px rgba(0, 0, 0, 0.2);
    }

    /* Input con iconos */
    .form-control {
        transition: all 0.2s ease-in-out;
    }
    .form-control:focus {
        border-color: #0071e3;
        box-shadow: 0 0 10px rgba(0, 113, 227, 0.3);
    }
</style>

<!-- Validaciones en tiempo real con JavaScript -->
<script>
    document.addEventListener("DOMContentLoaded", function () {
        const form = document.getElementById("paymentForm");
        const cardHolderInput = document.getElementById("cardholder_name");
        const cardNumberInput = document.getElementById("card_number");
        const expirationDateInput = document.getElementById("expiration_date");
        const cvvInput = document.getElementById("cvv");

        // Validar solo letras en el nombre del titular
        cardHolderInput.addEventListener("input", function () {
            this.value = this.value.replace(/[^a-zA-ZáéíóúÁÉÍÓÚñÑ\s]/g, "");
        });

        // Formato para el número de tarjeta #### #### #### ####
        cardNumberInput.addEventListener("input", function () {
            this.value = this.value.replace(/\D/g, "").replace(/(\d{4})/g, "$1 ").trim();
        });

        // Formato para la fecha MM/AA
        expirationDateInput.addEventListener("input", function () {
            this.value = this.value.replace(/\D/g, "").replace(/(\d{2})(\d{0,2})/, "$1/$2").trim();
        });

        // Validar que el mes sea entre 01 y 12
        expirationDateInput.addEventListener("blur", function () {
            const parts = this.value.split("/");
            if (parts.length === 2) {
                const month = parseInt(parts[0]);
                const year = parseInt(parts[1]);
                if (month < 1 || month > 12 || isNaN(year)) {
                    this.classList.add("is-invalid");
                } else {
                    this.classList.remove("is-invalid");
                }
            }
        });

        // Solo permitir 3 o 4 dígitos en CVV
        cvvInput.addEventListener("input", function () {
            this.value = this.value.replace(/\D/g, "").slice(0, 4);
        });

        // Validar el formulario antes de enviar
        form.addEventListener("submit", function (event) {
            let valid = true;

            if (!/^[a-zA-ZáéíóúÁÉÍÓÚñÑ\s]+$/.test(cardHolderInput.value.trim())) {
                cardHolderInput.classList.add("is-invalid");
                valid = false;
            } else {
                cardHolderInput.classList.remove("is-invalid");
            }

            if (!/^\d{4} \d{4} \d{4} \d{4}$/.test(cardNumberInput.value.trim())) {
                cardNumberInput.classList.add("is-invalid");
                valid = false;
            } else {
                cardNumberInput.classList.remove("is-invalid");
            }

            if (!/^\d{2}\/\d{2}$/.test(expirationDateInput.value.trim())) {
                expirationDateInput.classList.add("is-invalid");
                valid = false;
            } else {
                expirationDateInput.classList.remove("is-invalid");
            }

            if (!/^\d{3,4}$/.test(cvvInput.value.trim())) {
                cvvInput.classList.add("is-invalid");
                valid = false;
            } else {
                cvvInput.classList.remove("is-invalid");
            }

            if (!valid) {
                event.preventDefault();
            }
        });
    });
</script>
{% endblock %}
